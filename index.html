<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>PANKHURI ‚Äî A Constellation For You ‚ú®</title>
    <meta name="description"
        content="A Valentine star-map constellation gift spelling PANKHURI with real IAU-approved stars.">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Playfair+Display:ital,wght@0,400;0,600;1,400&display=swap"
        rel="stylesheet">
    <style>
        /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   CSS ‚Äî Valentine Star Map for PANKHURI
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
        *,
        *::before,
        *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0
        }

        :root {
            --bg: #0a0e27;
            --panel: rgba(15, 20, 50, 0.75);
            --border: rgba(255, 255, 255, 0.08);
            --rose: #f5b7b1;
            --gold: #e8a87c;
            --pink: #ff6b9d;
            --lavender: #c9b1ff;
            --text: #e8e6f0;
            --text-dim: rgba(232, 230, 240, 0.55);
            --star-glow: #ffe8a0;
            --glass-blur: 16px;
            --radius: 14px;
        }

        html,
        body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            background: var(--bg);
            color: var(--text);
            font-family: 'Inter', system-ui, sans-serif
        }

        canvas#skyCanvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1
        }

        /* ‚îÄ‚îÄ Glassmorphism panels ‚îÄ‚îÄ */
        .glass {
            background: var(--panel);
            backdrop-filter: blur(var(--glass-blur));
            -webkit-backdrop-filter: blur(var(--glass-blur));
            border: 1px solid var(--border);
            border-radius: var(--radius);
        }

        /* ‚îÄ‚îÄ Title overlay ‚îÄ‚îÄ */
        #titleOverlay {
            position: fixed;
            top: 16px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 20;
            text-align: center;
            pointer-events: none;
            width: 90vw;
            max-width: 500px;
        }

        #titleOverlay h1 {
            font-family: 'Playfair Display', serif;
            font-size: clamp(1.4rem, 3.5vw, 2.8rem);
            font-weight: 600;
            letter-spacing: 0.08em;
            background: linear-gradient(135deg, var(--rose), var(--gold), var(--lavender));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            filter: drop-shadow(0 0 20px rgba(245, 183, 177, 0.3));
            line-height: 1.2;
        }

        #titleOverlay p {
            font-family: 'Playfair Display', serif;
            font-style: italic;
            font-size: clamp(0.65rem, 1.5vw, 0.95rem);
            color: var(--rose);
            opacity: 0.7;
            margin-top: 4px;
            letter-spacing: 0.04em;
        }

        /* ‚îÄ‚îÄ Settings button (bottom-left) ‚îÄ‚îÄ */
        #settingsBtn {
            position: fixed;
            bottom: 16px;
            left: 16px;
            z-index: 25;
            width: 42px;
            height: 42px;
            border-radius: 50%;
            border: 1px solid var(--border);
            background: var(--panel);
            backdrop-filter: blur(var(--glass-blur));
            -webkit-backdrop-filter: blur(var(--glass-blur));
            color: var(--text);
            font-size: 1.2rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.3);
        }

        #settingsBtn:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.18);
            transform: rotate(45deg);
        }

        #settingsBtn.open {
            transform: rotate(90deg);
            border-color: var(--rose);
            background: rgba(245, 183, 177, 0.12);
        }

        /* ‚îÄ‚îÄ Settings popup menu ‚îÄ‚îÄ */
        #settingsMenu {
            position: fixed;
            bottom: 68px;
            left: 16px;
            z-index: 24;
            padding: 10px;
            display: flex;
            flex-direction: column;
            gap: 4px;
            min-width: 150px;
            opacity: 0;
            pointer-events: none;
            transform: translateY(8px) scale(0.95);
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            transform-origin: bottom left;
        }

        #settingsMenu.visible {
            opacity: 1;
            pointer-events: auto;
            transform: translateY(0) scale(1);
        }

        #settingsMenu button {
            font-family: 'Inter', sans-serif;
            font-size: 0.75rem;
            font-weight: 500;
            color: var(--text);
            cursor: pointer;
            padding: 8px 14px;
            border-radius: 8px;
            border: none;
            background: transparent;
            transition: all 0.2s ease;
            text-align: left;
            display: flex;
            align-items: center;
            gap: 8px;
            white-space: nowrap;
        }

        #settingsMenu button:hover {
            background: rgba(255, 255, 255, 0.08);
        }

        #settingsMenu button.active {
            color: var(--rose);
        }

        #settingsMenu button .check {
            width: 14px;
            text-align: center;
            font-size: 0.6rem;
        }

        /* ‚îÄ‚îÄ Info card ‚îÄ‚îÄ */
        #starCard {
            position: fixed;
            z-index: 30;
            width: min(320px, 90vw);
            padding: 20px;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease, transform 0.3s ease;
            transform: translateY(8px);
        }

        #starCard.visible {
            opacity: 1;
            pointer-events: auto;
            transform: translateY(0)
        }

        #starCard .card-letter {
            font-family: 'Playfair Display', serif;
            font-size: 2.4rem;
            font-weight: 600;
            background: linear-gradient(135deg, var(--gold), var(--pink));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            line-height: 1;
            float: left;
            margin-right: 10px;
        }

        #starCard h2 {
            font-family: 'Playfair Display', serif;
            font-size: 1.15rem;
            color: var(--gold);
            margin-bottom: 2px
        }

        #starCard .card-constellation {
            font-size: 0.75rem;
            color: var(--text-dim);
            margin-bottom: 10px
        }

        #starCard .card-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 6px 14px;
            font-size: 0.72rem;
            margin-bottom: 12px
        }

        #starCard .card-grid dt {
            color: var(--text-dim)
        }

        #starCard .card-grid dd {
            color: var(--text);
            text-align: right
        }

        #starCard .card-link {
            display: inline-block;
            font-size: 0.7rem;
            color: var(--lavender);
            text-decoration: none;
            border-bottom: 1px solid rgba(201, 177, 255, 0.3);
            transition: border-color 0.2s;
        }

        #starCard .card-link:hover {
            border-color: var(--lavender)
        }

        #starCard .card-horizon {
            font-size: 0.65rem;
            padding: 3px 8px;
            border-radius: 4px;
            margin-top: 6px;
            display: inline-block
        }

        #starCard .card-horizon.above {
            background: rgba(100, 255, 150, 0.1);
            color: #90eea0
        }

        #starCard .card-horizon.below {
            background: rgba(255, 100, 100, 0.1);
            color: #ff9090
        }

        #starCard .close-btn {
            position: absolute;
            top: 8px;
            right: 12px;
            background: none;
            border: none;
            color: var(--text-dim);
            font-size: 1.1rem;
            cursor: pointer;
            padding: 4px;
            line-height: 1;
        }

        /* ‚îÄ‚îÄ Tooltip (hover) ‚îÄ‚îÄ */
        #starTooltip {
            position: fixed;
            z-index: 25;
            padding: 6px 12px;
            font-size: 0.7rem;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s;
            white-space: nowrap;
        }

        #starTooltip.visible {
            opacity: 1
        }

        /* ‚îÄ‚îÄ Help & Sources panels ‚îÄ‚îÄ */
        .side-panel {
            position: fixed;
            z-index: 25;
            width: min(340px, 85vw);
            max-height: 70vh;
            overflow-y: auto;
            padding: 20px;
            top: 80px;
            opacity: 0;
            pointer-events: none;
            transition: all 0.3s ease;
            transform: translateX(-12px);
        }

        .side-panel.visible {
            opacity: 1;
            pointer-events: auto;
            transform: translateX(0)
        }

        .side-panel.left {
            left: 16px
        }

        .side-panel.right {
            right: 16px;
            transform: translateX(12px)
        }

        .side-panel.right.visible {
            transform: translateX(0)
        }

        .side-panel h3 {
            font-family: 'Playfair Display', serif;
            font-size: 1rem;
            color: var(--gold);
            margin-bottom: 10px
        }

        .side-panel p,
        .side-panel li {
            font-size: 0.72rem;
            line-height: 1.6;
            color: var(--text-dim)
        }

        .side-panel ul {
            list-style: none;
            padding-left: 0
        }

        .side-panel li::before {
            content: '‚ú¶ ';
            color: var(--rose)
        }

        .side-panel a {
            color: var(--lavender);
            text-decoration: none;
            border-bottom: 1px solid rgba(201, 177, 255, 0.2)
        }

        .side-panel .close-btn {
            position: absolute;
            top: 8px;
            right: 12px;
            background: none;
            border: none;
            color: var(--text-dim);
            font-size: 1rem;
            cursor: pointer
        }



        /* ‚îÄ‚îÄ Scrollbar ‚îÄ‚îÄ */
        ::-webkit-scrollbar {
            width: 4px
        }

        ::-webkit-scrollbar-track {
            background: transparent
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 2px
        }

        /* ‚îÄ‚îÄ Loading state ‚îÄ‚îÄ */
        #loadingOverlay {
            position: fixed;
            inset: 0;
            z-index: 200;
            background: var(--bg);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 16px;
            transition: opacity 0.8s ease;
        }

        #loadingOverlay.hidden {
            opacity: 0;
            pointer-events: none
        }

        #loadingOverlay p {
            font-family: 'Playfair Display', serif;
            color: var(--rose);
            font-size: 1rem
        }

        .loader {
            width: 40px;
            height: 40px;
            border: 2px solid var(--border);
            border-top-color: var(--rose);
            border-radius: 50%;
            animation: spin 1s linear infinite
        }

        @keyframes spin {
            to {
                transform: rotate(360deg)
            }
        }

        /* ‚îÄ‚îÄ Responsive ‚Äî small screens ‚îÄ‚îÄ */
        @media (max-width: 600px) {
            #titleOverlay {
                top: 8px;
                width: 94vw;
            }

            #titleOverlay h1 {
                font-size: clamp(1rem, 5vw, 1.6rem);
            }

            #titleOverlay p {
                font-size: 0.6rem;
            }

            #settingsBtn {
                bottom: 10px;
                left: 10px;
                width: 36px;
                height: 36px;
                font-size: 1rem;
            }

            #settingsMenu {
                bottom: 54px;
                left: 10px;
                min-width: 130px;
            }

            #starCard {
                width: min(280px, 85vw);
                padding: 14px;
            }

            .side-panel {
                width: min(280px, 85vw);
                top: 60px;
                padding: 14px;
            }
        }

        /* ‚îÄ‚îÄ Landscape phones ‚îÄ‚îÄ */
        @media (max-height: 500px) and (orientation: landscape) {
            #titleOverlay {
                top: 6px;
                width: auto;
                max-width: 50vw;
            }

            #titleOverlay h1 {
                font-size: clamp(0.8rem, 2.2vw, 1.2rem);
            }

            #titleOverlay p {
                font-size: 0.5rem;
            }

            #starCard {
                width: min(240px, 35vw);
                padding: 10px;
            }

            .side-panel {
                top: 40px;
                max-height: 80vh;
                width: min(260px, 38vw);
            }
        }
    </style>
</head>

<body>

    <!-- Loading -->
    <div id="loadingOverlay">
        <div class="loader"></div>
        <p>Mapping the stars‚Ä¶</p>
    </div>



    <!-- Sky canvas -->
    <canvas id="skyCanvas"></canvas>

    <!-- Title -->
    <div id="titleOverlay">
        <p>A star constellation for my pretty baby</p>
    </div>

    <!-- Settings button -->
    <button id="settingsBtn" title="Settings">‚öôÔ∏è</button>

    <!-- Settings popup menu -->
    <div id="settingsMenu" class="glass">
        <button id="btnLines" class="active"><span class="check">‚úì</span> Lines</button>
        <button id="btnLabels" class="active"><span class="check">‚úì</span> Labels</button>
        <button id="btnHelp">‚ùì Help</button>
        <button id="btnSources">üìö Sources</button>
    </div>

    <!-- Star info card -->
    <div id="starCard" class="glass">
        <button class="close-btn" onclick="hideStarCard()">&times;</button>
        <div id="cardContent"></div>
    </div>

    <!-- Tooltip -->
    <div id="starTooltip" class="glass"></div>

    <!-- Help panel -->
    <div id="helpPanel" class="side-panel glass left">
        <button class="close-btn" onclick="togglePanel('helpPanel')">&times;</button>
        <h3>How to Use</h3>
        <ul>
            <li>Toggle <b>Lines</b> to show/hide the constellation connections.</li>
            <li>Toggle <b>Labels</b> to show/hide star name labels.</li>
            <li><b>Click any bright star</b> to see its real astronomical data.</li>
            <li><b>Click anywhere</b> on the sky for a shooting star ‚ú®.</li>
            <li>Stars are plotted at their real J2000 equatorial positions.</li>
            <li>On mobile, rotate to landscape for the best experience.</li>
        </ul>
    </div>

    <!-- Sources panel -->
    <div id="sourcesPanel" class="side-panel glass right">
        <button class="close-btn" onclick="togglePanel('sourcesPanel')">&times;</button>
        <h3>Sources &amp; References</h3>
        <p style="margin-bottom:8px">All 8 star names are <b>IAU WGSN-approved</b> proper names.</p>
        <ul>
            <li><a href="https://www.iau.org/public/themes/naming_stars/" target="_blank" rel="noopener">IAU Star
                    Naming</a></li>
            <li><a href="https://simbad.u-strasbg.fr/simbad/" target="_blank" rel="noopener">SIMBAD Database</a> ‚Äî J2000
                coordinates</li>
            <li><a href="https://en.wikipedia.org/wiki/List_of_IAU-approved_star_names" target="_blank"
                    rel="noopener">Wikipedia: IAU Star Names</a></li>
            <li>Coordinate transforms: <a href="https://github.com/cosinekitty/astronomy" target="_blank"
                    rel="noopener">astronomy-engine</a></li>
        </ul>
        <p style="margin-top:10px;font-size:0.65rem;color:var(--text-dim)">Projection: Stereographic. Epoch: J2000.
            Coordinates verified against SIMBAD &amp; Wikipedia.</p>
    </div>


    <script>
        /**
         * ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
         * Valentine Star Map ‚Äî PANKHURI Constellation
         * 
         * Astronomy: RA/Dec J2000 ‚Üí Alt/Az via astronomy-engine,
         * then stereographic projection to 2D canvas.
         * All star names IAU WGSN-approved. Coords from SIMBAD.
         * ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
         */

        // ‚îÄ‚îÄ Star database: 8 IAU-approved stars for P-A-N-K-H-U-R-I ‚îÄ‚îÄ
        // Stars chosen in the Bo√∂tes‚ÄìVirgo‚ÄìSerpens‚ÄìHercules‚ÄìOphiuchus region
        // (RA ~12.5‚Äì17.6 h) for a compact constellation with minimal line crossings.
        const STARS = [
            {
                letter: 'P', name: 'Porrima', designation: 'Œ≥ Vir',
                constellation: 'Virgo', spectral: 'F0V',
                mag: 2.74, distLy: 39,
                raH: 12, raM: 41, raS: 39.64,
                decD: 1, decM: 26, decS: 57.7, decSign: -1,
                wiki: 'https://en.wikipedia.org/wiki/Gamma_Virginis',
                simbad: 'https://simbad.u-strasbg.fr/simbad/sim-id?Ident=gam+Vir'
            },
            {
                letter: 'A', name: 'Arcturus', designation: 'Œ± Boo',
                constellation: 'Bo√∂tes', spectral: 'K1.5III',
                mag: -0.05, distLy: 37,
                raH: 14, raM: 15, raS: 39.67,
                decD: 19, decM: 10, decS: 56.7, decSign: 1,
                wiki: 'https://en.wikipedia.org/wiki/Arcturus',
                simbad: 'https://simbad.u-strasbg.fr/simbad/sim-id?Ident=alf+Boo'
            },
            {
                letter: 'N', name: 'Nekkar', designation: 'Œ≤ Boo',
                constellation: 'Bo√∂tes', spectral: 'G8IIIa',
                mag: 3.49, distLy: 219,
                raH: 15, raM: 1, raS: 56.76,
                decD: 40, decM: 23, decS: 26.0, decSign: 1,
                wiki: 'https://en.wikipedia.org/wiki/Beta_Bo%C3%B6tis',
                simbad: 'https://simbad.u-strasbg.fr/simbad/sim-id?Ident=bet+Boo'
            },
            {
                letter: 'K', name: 'Kornephoros', designation: 'Œ≤ Her',
                constellation: 'Hercules', spectral: 'G7IIIa',
                mag: 2.78, distLy: 139,
                raH: 16, raM: 30, raS: 13.25,
                decD: 21, decM: 29, decS: 22.6, decSign: 1,
                wiki: 'https://en.wikipedia.org/wiki/Beta_Herculis',
                simbad: 'https://simbad.u-strasbg.fr/simbad/sim-id?Ident=bet+Her'
            },
            {
                letter: 'H', name: 'Heze', designation: 'Œ∂ Vir',
                constellation: 'Virgo', spectral: 'A3V',
                mag: 3.37, distLy: 73,
                raH: 13, raM: 34, raS: 41.59,
                decD: 0, decM: 35, decS: 44.6, decSign: -1,
                wiki: 'https://en.wikipedia.org/wiki/Zeta_Virginis',
                simbad: 'https://simbad.u-strasbg.fr/simbad/sim-id?Ident=zet+Vir'
            },
            {
                letter: 'U', name: 'Unukalhai', designation: 'Œ± Ser',
                constellation: 'Serpens', spectral: 'K2III',
                mag: 2.63, distLy: 74,
                raH: 15, raM: 44, raS: 16.07,
                decD: 6, decM: 25, decS: 32.3, decSign: 1,
                wiki: 'https://en.wikipedia.org/wiki/Unukalhai',
                simbad: 'https://simbad.u-strasbg.fr/simbad/sim-id?Ident=alf+Ser'
            },
            {
                letter: 'R', name: 'Rasalhague', designation: 'Œ± Oph',
                constellation: 'Ophiuchus', spectral: 'A5III',
                mag: 2.07, distLy: 49,
                raH: 17, raM: 34, raS: 56.07,
                decD: 12, decM: 33, decS: 36.1, decSign: 1,
                wiki: 'https://en.wikipedia.org/wiki/Rasalhague',
                simbad: 'https://simbad.u-strasbg.fr/simbad/sim-id?Ident=alf+Oph'
            },
            {
                letter: 'I', name: 'Izar', designation: 'Œµ Boo',
                constellation: 'Bo√∂tes', spectral: 'K0II-III',
                mag: 2.37, distLy: 210,
                raH: 14, raM: 44, raS: 59.22,
                decD: 27, decM: 4, decS: 27.2, decSign: 1,
                wiki: 'https://en.wikipedia.org/wiki/Izar_(star)',
                simbad: 'https://simbad.u-strasbg.fr/simbad/sim-id?Ident=eps+Boo'
            }
        ];

        // ‚îÄ‚îÄ Convert star RA/Dec to decimal degrees ‚îÄ‚îÄ
        STARS.forEach(s => {
            s.raDeg = (s.raH + s.raM / 60 + s.raS / 3600) * 15; // hours ‚Üí degrees
            s.decDeg = s.decSign * (s.decD + s.decM / 60 + s.decS / 3600);
            s.raStr = `${s.raH}h ${s.raM}m ${s.raS.toFixed(1)}s`;
            s.decStr = `${s.decSign < 0 ? '‚àí' : '+'}${s.decD}¬∞ ${s.decM}‚Ä≤ ${s.decS.toFixed(1)}‚Ä≥`;
        });

        // ‚îÄ‚îÄ State ‚îÄ‚îÄ
        let showLines = true, showLabels = true;
        let projectedStars = []; // [{x, y, star}]
        let shootingStars = [];
        let faintStars = []; // random background stars
        let animFrame = null;

        // ‚îÄ‚îÄ DOM refs ‚îÄ‚îÄ
        const canvas = document.getElementById('skyCanvas');
        const ctx = canvas.getContext('2d');

        // ‚îÄ‚îÄ Resize canvas to device pixels ‚îÄ‚îÄ
        function resize() {
            const dpr = window.devicePixelRatio || 1;
            canvas.width = window.innerWidth * dpr;
            canvas.height = window.innerHeight * dpr;
            ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
            generateFaintStars();
            reproject();
        }
        window.addEventListener('resize', resize);

        /**
         * Generate random faint background stars for ambiance.
         * These are NOT real stars ‚Äî purely decorative.
         */
        function generateFaintStars() {
            faintStars = [];
            // Denser star field for realistic sky
            const count = Math.min(1200, Math.floor(window.innerWidth * window.innerHeight / 800));
            for (let i = 0; i < count; i++) {
                // Magnitude-based sizing: most stars are dim and tiny
                const mag = Math.random();
                const r = mag < 0.85 ? Math.random() * 0.8 + 0.2    // 85% tiny
                    : mag < 0.97 ? Math.random() * 1.0 + 0.6    // 12% medium
                        : Math.random() * 1.4 + 1.0;                // 3% bright
                faintStars.push({
                    x: Math.random() * window.innerWidth,
                    y: Math.random() * window.innerHeight,
                    r,
                    alpha: Math.min(0.6, r * 0.25 + Math.random() * 0.15),
                    twinkleSpeed: Math.random() * 0.003 + 0.001,
                    twinkleOffset: Math.random() * Math.PI * 2
                });
            }
        }

        /**
         * ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
         * PROJECTION: RA/Dec ‚Üí Screen (direct)
         * 
         * Uses stereographic projection directly from
         * equatorial J2000 coordinates (RA/Dec) onto
         * a 2D star-chart view. This gives a fixed,
         * real star-map layout matching celestial atlases.
         * No observer location/time dependency.
         *
         * Stereographic is conformal (angle-preserving)
         * and handles the ~50¬∞ field of this region well.
         * ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
         */

        /**
         * Stereographic projection from spherical (RA, Dec) to 2D.
         * @param {number} ra  - Right Ascension in degrees
         * @param {number} dec - Declination in degrees
         * @param {number} ra0 - Center RA in degrees
         * @param {number} dec0- Center Dec in degrees
         * @returns {{x: number, y: number}} projected coords
         */
        function stereographicProject(ra, dec, ra0, dec0) {
            const toRad = Math.PI / 180;
            const a = ra * toRad, d = dec * toRad;
            const a0 = ra0 * toRad, d0 = dec0 * toRad;

            const cosC = Math.sin(d0) * Math.sin(d)
                + Math.cos(d0) * Math.cos(d) * Math.cos(a - a0);
            const k = 2 / (1 + cosC);

            // x positive = east on sky; flip for chart (east-left)
            const x = -k * Math.cos(d) * Math.sin(a - a0);
            const y = k * (Math.cos(d0) * Math.sin(d)
                - Math.sin(d0) * Math.cos(d) * Math.cos(a - a0));
            return { x, y };
        }

        /**
         * Project all 8 stars to screen coords using direct RA/Dec.
         * Like a real star chart ‚Äî positions are fixed regardless of
         * observer location or time.
         */
        function reproject() {
            const W = window.innerWidth, H = window.innerHeight;

            // Centroid in equatorial coords (average in Cartesian for safety)
            const toRad = Math.PI / 180;
            let cx = 0, cy = 0, cz = 0;
            STARS.forEach(s => {
                const a = s.raDeg * toRad, d = s.decDeg * toRad;
                cx += Math.cos(d) * Math.cos(a);
                cy += Math.cos(d) * Math.sin(a);
                cz += Math.sin(d);
            });
            cx /= 8; cy /= 8; cz /= 8;
            const centerRA = Math.atan2(cy, cx) / toRad;
            const centerDec = Math.atan2(cz, Math.sqrt(cx * cx + cy * cy)) / toRad;

            // Project all stars
            const raw = STARS.map(s => {
                const p = stereographicProject(s.raDeg, s.decDeg, centerRA, centerDec);
                return { ...p, star: s };
            });

            // Bounding box ‚Üí fit to screen with asymmetric margins
            // On mobile: extra top margin for title, extra right for controls
            let minX = Infinity, maxX = -Infinity, minY = Infinity, maxY = -Infinity;
            raw.forEach(p => {
                if (p.x < minX) minX = p.x;
                if (p.x > maxX) maxX = p.x;
                if (p.y < minY) minY = p.y;
                if (p.y > maxY) maxY = p.y;
            });

            const rangeX = maxX - minX || 1;
            const rangeY = maxY - minY || 1;

            const isMobilePortrait = W < 600 && H > W;
            const marginTop = isMobilePortrait ? 0.14 : 0.12;
            const marginBottom = isMobilePortrait ? 0.06 : 0.10;
            const marginLeft = isMobilePortrait ? 0.06 : 0.10;
            const marginRight = isMobilePortrait ? 0.06 : 0.10;

            const usableW = W * (1 - marginLeft - marginRight);
            const usableH = H * (1 - marginTop - marginBottom);
            const scale = Math.min(usableW / rangeX, usableH / rangeY);

            const midX = (minX + maxX) / 2;
            const midY = (minY + maxY) / 2;

            // Offset center: shift constellation away from UI edges
            const centerOffsetX = W * (marginLeft - marginRight) / 2;
            const centerOffsetY = H * (marginTop - marginBottom) / 2;

            projectedStars = raw.map(p => ({
                x: W / 2 + centerOffsetX + (p.x - midX) * scale,
                y: H / 2 + centerOffsetY + (p.y - midY) * scale,
                star: p.star
            }));
        }

        // ‚îÄ‚îÄ Drawing ‚îÄ‚îÄ
        let frameTime = 0;

        function draw(timestamp) {
            frameTime = timestamp || 0;
            const W = window.innerWidth, H = window.innerHeight;
            ctx.clearRect(0, 0, W, H);

            // Background gradient (realistic deep space)
            const bgGrad = ctx.createLinearGradient(0, 0, 0, H);
            bgGrad.addColorStop(0, '#050714');
            bgGrad.addColorStop(0.3, '#0a0e24');
            bgGrad.addColorStop(0.55, '#0d1230');
            bgGrad.addColorStop(0.8, '#0a0e24');
            bgGrad.addColorStop(1, '#040610');
            ctx.fillStyle = bgGrad;
            ctx.fillRect(0, 0, W, H);

            // Subtle nebula / gas cloud patches
            const nebulaPatches = [
                { x: W * 0.2, y: H * 0.3, rx: W * 0.22, ry: H * 0.15, angle: -0.3, color: [60, 30, 90] },
                { x: W * 0.75, y: H * 0.65, rx: W * 0.18, ry: H * 0.12, angle: 0.5, color: [40, 20, 60] },
                { x: W * 0.5, y: H * 0.15, rx: W * 0.25, ry: H * 0.08, angle: -0.1, color: [20, 30, 50] },
                { x: W * 0.85, y: H * 0.25, rx: W * 0.12, ry: H * 0.18, angle: 0.8, color: [50, 25, 45] },
            ];
            nebulaPatches.forEach(n => {
                ctx.save();
                ctx.translate(n.x, n.y);
                ctx.rotate(n.angle);
                ctx.scale(1, n.ry / n.rx);
                const ng = ctx.createRadialGradient(0, 0, 0, 0, 0, n.rx);
                ng.addColorStop(0, `rgba(${n.color[0]}, ${n.color[1]}, ${n.color[2]}, 0.06)`);
                ng.addColorStop(0.5, `rgba(${n.color[0]}, ${n.color[1]}, ${n.color[2]}, 0.025)`);
                ng.addColorStop(1, 'rgba(0, 0, 0, 0)');
                ctx.fillStyle = ng;
                ctx.beginPath();
                ctx.arc(0, 0, n.rx, 0, Math.PI * 2);
                ctx.fill();
                ctx.restore();
            });

            // Milky Way haze (wider, more realistic band)
            ctx.save();
            ctx.translate(W * 0.35, H * 0.55);
            ctx.rotate(-0.35);
            ctx.scale(2.2, 0.4);
            const milkyGrad = ctx.createRadialGradient(0, 0, 0, 0, 0, W * 0.4);
            milkyGrad.addColorStop(0, 'rgba(160, 160, 200, 0.045)');
            milkyGrad.addColorStop(0.3, 'rgba(130, 130, 190, 0.025)');
            milkyGrad.addColorStop(0.7, 'rgba(100, 100, 160, 0.01)');
            milkyGrad.addColorStop(1, 'rgba(0, 0, 0, 0)');
            ctx.fillStyle = milkyGrad;
            ctx.fillRect(-W, -H, W * 3, H * 3);
            ctx.restore();

            // Faint background stars with realistic colors
            const starColors = [
                [200, 210, 255],   // blue-white (O/B type)
                [220, 225, 255],   // white-blue (A type)
                [255, 255, 240],   // white (F type)
                [255, 245, 220],   // yellow-white (G type)
                [255, 220, 180],   // yellow-orange (K type)
                [255, 190, 150],   // orange-red (M type)
            ];
            faintStars.forEach(fs => {
                const twinkle = 0.5 + 0.5 * Math.sin(frameTime * fs.twinkleSpeed + fs.twinkleOffset);
                const a = fs.alpha * (0.5 + 0.5 * twinkle);
                // Pick color based on position hash for consistency
                const colorIdx = Math.floor((fs.x * 7 + fs.y * 13) % starColors.length);
                const [cr, cg, cb] = starColors[colorIdx];
                // Tiny glow for brighter stars
                if (fs.r > 1.0) {
                    const glowR = fs.r * 3;
                    const glow = ctx.createRadialGradient(fs.x, fs.y, 0, fs.x, fs.y, glowR);
                    glow.addColorStop(0, `rgba(${cr}, ${cg}, ${cb}, ${a * 0.3})`);
                    glow.addColorStop(1, 'rgba(0, 0, 0, 0)');
                    ctx.fillStyle = glow;
                    ctx.fillRect(fs.x - glowR, fs.y - glowR, glowR * 2, glowR * 2);
                }
                ctx.beginPath();
                ctx.arc(fs.x, fs.y, fs.r, 0, Math.PI * 2);
                ctx.fillStyle = `rgba(${cr}, ${cg}, ${cb}, ${a})`;
                ctx.fill();
            });

            // Constellation lines (P‚ÜíA‚ÜíN‚ÜíK‚ÜíH‚ÜíU‚ÜíR‚ÜíI)
            if (showLines && projectedStars.length === 8) {
                ctx.save();
                ctx.lineWidth = 1.5;
                ctx.lineCap = 'round';
                ctx.lineJoin = 'round';
                ctx.shadowColor = 'rgba(245, 183, 177, 0.5)';
                ctx.shadowBlur = 12;

                // Main path
                ctx.beginPath();
                for (let i = 0; i < projectedStars.length; i++) {
                    const p = projectedStars[i];
                    if (i === 0) ctx.moveTo(p.x, p.y);
                    else ctx.lineTo(p.x, p.y);
                }
                const lineGrad = ctx.createLinearGradient(
                    projectedStars[0].x, projectedStars[0].y,
                    projectedStars[7].x, projectedStars[7].y
                );
                lineGrad.addColorStop(0, 'rgba(245, 183, 177, 0.6)');
                lineGrad.addColorStop(0.5, 'rgba(232, 168, 124, 0.5)');
                lineGrad.addColorStop(1, 'rgba(201, 177, 255, 0.6)');
                ctx.strokeStyle = lineGrad;
                ctx.stroke();
                ctx.shadowBlur = 0;

                // Secondary glow layer
                ctx.lineWidth = 4;
                ctx.globalAlpha = 0.15;
                ctx.beginPath();
                for (let i = 0; i < projectedStars.length; i++) {
                    const p = projectedStars[i];
                    if (i === 0) ctx.moveTo(p.x, p.y);
                    else ctx.lineTo(p.x, p.y);
                }
                ctx.strokeStyle = 'rgba(245, 183, 177, 0.4)';
                ctx.stroke();
                ctx.globalAlpha = 1;
                ctx.restore();
            }

            // Named stars (the 8 PANKHURI stars)
            projectedStars.forEach((ps, idx) => {
                const s = ps.star;
                const twinkle = 0.7 + 0.3 * Math.sin(frameTime * 0.002 + idx * 1.3);

                // Magnitude ‚Üí visual radius (brighter = bigger)
                const baseR = Math.max(2.5, 6 - s.mag * 1.2);
                const r = baseR * twinkle;

                // Outer glow
                const glowGrad = ctx.createRadialGradient(ps.x, ps.y, 0, ps.x, ps.y, r * 5);
                glowGrad.addColorStop(0, `rgba(255, 232, 160, ${0.25 * twinkle})`);
                glowGrad.addColorStop(0.3, `rgba(245, 183, 177, ${0.1 * twinkle})`);
                glowGrad.addColorStop(1, 'rgba(0, 0, 0, 0)');
                ctx.beginPath();
                ctx.arc(ps.x, ps.y, r * 5, 0, Math.PI * 2);
                ctx.fillStyle = glowGrad;
                ctx.fill();

                // Star core
                ctx.beginPath();
                ctx.arc(ps.x, ps.y, r, 0, Math.PI * 2);
                const coreGrad = ctx.createRadialGradient(ps.x, ps.y, 0, ps.x, ps.y, r);
                coreGrad.addColorStop(0, '#ffffff');
                coreGrad.addColorStop(0.4, 'rgba(255, 240, 210, 0.95)');
                coreGrad.addColorStop(1, 'rgba(245, 183, 177, 0.5)');
                ctx.fillStyle = coreGrad;
                ctx.fill();

                // Cross spikes for extra sparkle
                ctx.save();
                ctx.globalAlpha = 0.3 * twinkle;
                ctx.strokeStyle = '#ffe8a0';
                ctx.lineWidth = 0.8;
                const spikeLen = r * 3;
                ctx.beginPath();
                ctx.moveTo(ps.x - spikeLen, ps.y); ctx.lineTo(ps.x + spikeLen, ps.y);
                ctx.moveTo(ps.x, ps.y - spikeLen); ctx.lineTo(ps.x, ps.y + spikeLen);
                ctx.stroke();
                ctx.restore();

                // Labels
                if (showLabels) {
                    ctx.save();
                    ctx.font = '600 13px Inter, sans-serif';
                    ctx.fillStyle = 'rgba(232, 168, 124, 0.9)';
                    ctx.textAlign = 'left';
                    ctx.textBaseline = 'middle';
                    const labelX = ps.x + r * 2.5 + 6;
                    const labelY = ps.y;
                    // Letter badge
                    ctx.fillText(s.letter, labelX, labelY);
                    // Star name (smaller)
                    ctx.font = '300 10px Inter, sans-serif';
                    ctx.fillStyle = 'rgba(232, 230, 240, 0.5)';
                    ctx.fillText(s.name, labelX + 14, labelY);
                    ctx.restore();
                }
            });

            // Shooting stars
            shootingStars = shootingStars.filter(ss => {
                ss.progress += ss.speed;
                if (ss.progress > 1) return false;
                const t = ss.progress;
                const x = ss.x0 + (ss.x1 - ss.x0) * t;
                const y = ss.y0 + (ss.y1 - ss.y0) * t;
                const tailLen = 60;
                const alpha = t < 0.3 ? t / 0.3 : (1 - t) / 0.7;

                ctx.save();
                const angle = Math.atan2(ss.y1 - ss.y0, ss.x1 - ss.x0);
                const tailX = x - Math.cos(angle) * tailLen;
                const tailY = y - Math.sin(angle) * tailLen;

                const grad = ctx.createLinearGradient(tailX, tailY, x, y);
                grad.addColorStop(0, 'rgba(255,255,255,0)');
                grad.addColorStop(1, `rgba(255,240,220,${alpha * 0.8})`);
                ctx.strokeStyle = grad;
                ctx.lineWidth = 1.5;
                ctx.beginPath();
                ctx.moveTo(tailX, tailY);
                ctx.lineTo(x, y);
                ctx.stroke();

                // Head glow
                ctx.beginPath();
                ctx.arc(x, y, 2, 0, Math.PI * 2);
                ctx.fillStyle = `rgba(255,255,255,${alpha})`;
                ctx.fill();
                ctx.restore();
                return true;
            });

            animFrame = requestAnimationFrame(draw);
        }

        /** Spawn a shooting star from near a click point */
        function spawnShootingStar(cx, cy) {
            const angle = Math.random() * Math.PI * 2;
            const dist = 150 + Math.random() * 200;
            shootingStars.push({
                x0: cx + Math.cos(angle) * 30,
                y0: cy + Math.sin(angle) * 30,
                x1: cx + Math.cos(angle) * dist,
                y1: cy + Math.sin(angle) * dist,
                progress: 0,
                speed: 0.015 + Math.random() * 0.015
            });
        }

        // ‚îÄ‚îÄ Star info card ‚îÄ‚îÄ
        function showStarCard(ps, screenX, screenY) {
            const s = ps.star;
            const W = window.innerWidth, H = window.innerHeight;
            const card = document.getElementById('starCard');
            const content = document.getElementById('cardContent');

            content.innerHTML = `
    <div class="card-letter">${s.letter}</div>
    <h2>${s.name}</h2>
    <div class="card-constellation">${s.designation} ¬∑ ${s.constellation}</div>
    <dl class="card-grid">
      <dt>Magnitude</dt><dd>${s.mag.toFixed(2)}</dd>
      <dt>Spectral Type</dt><dd>${s.spectral}</dd>
      <dt>Distance</dt><dd>~${s.distLy} ly</dd>
      <dt>RA (J2000)</dt><dd>${s.raStr}</dd>
      <dt>Dec (J2000)</dt><dd>${s.decStr}</dd>
    </dl>
    <div style="margin-top:10px">
      <a class="card-link" href="${s.wiki}" target="_blank" rel="noopener">Wikipedia ‚Üó</a>
      &nbsp;¬∑&nbsp;
      <a class="card-link" href="${s.simbad}" target="_blank" rel="noopener">SIMBAD ‚Üó</a>
    </div>
  `;

            // Position card near star but within viewport
            let left = screenX + 20;
            let top = screenY - 60;
            if (left + 320 > W) left = screenX - 340;
            if (top < 10) top = 10;
            if (top + 350 > H) top = H - 360;
            if (left < 10) left = 10;

            card.style.left = left + 'px';
            card.style.top = top + 'px';
            card.classList.add('visible');
        }

        function hideStarCard() {
            document.getElementById('starCard').classList.remove('visible');
        }

        // ‚îÄ‚îÄ Tooltip ‚îÄ‚îÄ
        function showTooltip(ps, x, y) {
            const tip = document.getElementById('starTooltip');
            tip.textContent = `${ps.star.letter} ‚Äî ${ps.star.name} (${ps.star.constellation}, mag ${ps.star.mag})`;
            tip.style.left = (x + 14) + 'px';
            tip.style.top = (y - 10) + 'px';
            tip.classList.add('visible');
        }
        function hideTooltip() {
            document.getElementById('starTooltip').classList.remove('visible');
        }

        /** Find nearest projected star within hit radius */
        function hitTest(x, y, radius = 25) {
            let best = null, bestDist = radius;
            projectedStars.forEach(ps => {
                const d = Math.hypot(ps.x - x, ps.y - y);
                if (d < bestDist) { bestDist = d; best = ps; }
            });
            return best;
        }

        // ‚îÄ‚îÄ Event handlers ‚îÄ‚îÄ
        canvas.addEventListener('click', (e) => {
            const hit = hitTest(e.clientX, e.clientY);
            if (hit) {
                showStarCard(hit, e.clientX, e.clientY);
            } else {
                hideStarCard();
                spawnShootingStar(e.clientX, e.clientY);
            }
        });

        canvas.addEventListener('mousemove', (e) => {
            const hit = hitTest(e.clientX, e.clientY, 30);
            if (hit) {
                canvas.style.cursor = 'pointer';
                showTooltip(hit, e.clientX, e.clientY);
            } else {
                canvas.style.cursor = 'default';
                hideTooltip();
            }
        });

        // Touch support
        canvas.addEventListener('touchstart', (e) => {
            const t = e.touches[0];
            const hit = hitTest(t.clientX, t.clientY, 35);
            if (hit) {
                showStarCard(hit, t.clientX, t.clientY);
                e.preventDefault();
            } else {
                hideStarCard();
                spawnShootingStar(t.clientX, t.clientY);
            }
        }, { passive: false });

        // ‚îÄ‚îÄ Settings button toggle ‚îÄ‚îÄ
        const settingsBtn = document.getElementById('settingsBtn');
        const settingsMenu = document.getElementById('settingsMenu');

        settingsBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            const isOpen = settingsMenu.classList.toggle('visible');
            settingsBtn.classList.toggle('open', isOpen);
        });

        // Close menu when clicking elsewhere
        document.addEventListener('click', (e) => {
            if (!settingsMenu.contains(e.target) && e.target !== settingsBtn) {
                settingsMenu.classList.remove('visible');
                settingsBtn.classList.remove('open');
            }
        });

        // ‚îÄ‚îÄ Menu button listeners ‚îÄ‚îÄ
        document.getElementById('btnLines').addEventListener('click', function () {
            showLines = !showLines;
            this.classList.toggle('active');
            this.querySelector('.check').textContent = showLines ? '‚úì' : '';
        });

        document.getElementById('btnLabels').addEventListener('click', function () {
            showLabels = !showLabels;
            this.classList.toggle('active');
            this.querySelector('.check').textContent = showLabels ? '‚úì' : '';
        });

        function togglePanel(id) {
            const panel = document.getElementById(id);
            panel.classList.toggle('visible');
            const otherId = id === 'helpPanel' ? 'sourcesPanel' : 'helpPanel';
            document.getElementById(otherId).classList.remove('visible');
            // Close settings menu
            settingsMenu.classList.remove('visible');
            settingsBtn.classList.remove('open');
        }

        document.getElementById('btnHelp').addEventListener('click', () => togglePanel('helpPanel'));
        document.getElementById('btnSources').addEventListener('click', () => togglePanel('sourcesPanel'));

        // ‚îÄ‚îÄ Periodic auto-shooting star for ambiance ‚îÄ‚îÄ
        function autoShootingStar() {
            if (Math.random() < 0.3) {
                const W = window.innerWidth, H = window.innerHeight;
                spawnShootingStar(Math.random() * W, Math.random() * H * 0.5);
            }
            setTimeout(autoShootingStar, 3000 + Math.random() * 5000);
        }

        // ‚îÄ‚îÄ Initialize ‚îÄ‚îÄ
        function init() {
            resize();

            // Hide loading overlay
            setTimeout(() => {
                document.getElementById('loadingOverlay').classList.add('hidden');
            }, 800);

            // Start render loop
            requestAnimationFrame(draw);

            // Start ambient shooting stars after a delay
            setTimeout(autoShootingStar, 4000);
        }

        // Wait for DOM ready then init
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
    </script>
</body>

</html>
